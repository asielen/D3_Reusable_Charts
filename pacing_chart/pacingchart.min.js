function makePacingChart(t){let e={};function s(t,s){return function(){e.objs.tooltip.transition().duration(200),e.objs.tooltip.html(e.tooltipGenerator(t,s))}}function a(t){return t?((t=t.replace(/[^a-z0-9-]/g,function(t){var e=t.charCodeAt(0);return 32==e||95==e?"-":e>=65&&e<=90?t.toLowerCase():"_"})).match(/^[0-9]/g)&&(t="_"+t),t):""}return e.settings={data:null,selector:null,targetsCols:[],targetsMarkersCols:[],resultsCols:[],resultMarkersCols:[],titleCols:[],chartWidth:500,barHeight:35,titlePadding:100,lowerSummaryPadding:20,minWidthForPercent:100,cumulativeTargets:!0,cumulativeResults:!0,summarizeTargets:!1,summarizeResults:!1,w_threshold:25,p_threshold:.1,_constrainToTarget:!1,_constrainToTargetAdj:50,_minDisplayWidth:1e3},e.groupObjs={},e.objs={mainDiv:null,chartDiv:null,g:null},e.set=t=>{let s=!1;for(let a in t)e.settings[a]=t[a],"data"===a&&(e.data=e.settings.data,s=!0);return e.width=e.settings.chartWidth,e.height=e.settings.barHeight*(2+e.settings.summarizeTargets+e.settings.summarizeResults)+e.settings.lowerSummaryPadding,e.barWidth=e.settings.chartWidth-e.settings.titlePadding,e.settings._constrainToTarget&&(e.barWidth-=e.settings._constrainToTargetAdj),e.barHeight=e.settings.barHeight,s&&function t(){let s=(t,e)=>t.value<e.value?-1:t.value>e.value?1:0,a=(t,a,r)=>{let l=[];for(let i of t){let n=i,u=i;"string"!=typeof i&&(n=i[0],u=i[1]),l.push({column:n,name:u,value:e.data[a][n]}),r||l.sort(s)}return l};function r(t,s){var r;let l={title:"",subtitle:null,index:0,classes:[],unique_id:"",svg:{parent:null,title:null,subtitle:null,targets:null,results:null,targetsMarkers:null,resultsMarkers:null},metrics:{targets:[],results:[],targetsMarkers:[],resultsMarkers:[]}};return l.index=s,l.unique_id="g"+s+"-"+Math.random().toString(16).slice(2),t.unique_id=l.unique_id,"string"!=typeof e.settings.titleCols?(l.title=t[e.settings.titleCols[0]],l.subtitle=t[e.settings.titleCols[1]]):l.title=t[e.settings.titleCols],l.metrics.targets=a(e.settings.targetsCols,s,e.settings.cumulativeTargets),l.metrics.targetsMarkers=a(e.settings.targetsMarkersCols,s,e.settings.cumulativeTargets),l.metrics.results=a(e.settings.resultsCols,s,e.settings.cumulativeResults),l.metrics.resultsMarkers=a(e.settings.resultMarkersCols,s,e.settings.cumulativeResults),l.metrics.resultsLastIndex=l.metrics.results.length-1,l.metrics.targetsMax=e.settings.cumulativeTargets?Math.max(...l.metrics.targets.map(t=>t.value)):l.metrics.targets.map(t=>+t.value).reduce((t,e)=>t+e),l.metrics.targetsMarkersMax=Math.max(...l.metrics.targetsMarkers.map(t=>t.value)),l.metrics.resultsMax=e.settings.cumulativeResults?Math.max(...l.metrics.results.map(t=>t.value)):l.metrics.results.map(t=>+t.value).reduce((t,e)=>t+e),l.metrics.resultsMin=Math.min(...l.metrics.results.map(t=>t.value)),l.metrics.resultsMarkersMax=Math.max(...l.metrics.resultsMarkers.map(t=>t.value)),l.metrics.resultsMarkersMin=Math.min(...l.metrics.resultsMarkers.map(t=>t.value)),l.metrics.metricsMax=Math.max(l.metrics.targetsMax,l.metrics.resultsMax,l.metrics.targetsMarkersMax,l.metrics.resultsMarkersMax),l.metrics.results.forEach(t=>{t.percent_to_target=t.value/l.metrics.targetsMax}),l.metrics.resultsMarkers.forEach(t=>{t.percent_to_target=t.value/l.metrics.targetsMax}),l.classes.push("p"+Math.round(10*Math.ceil((r=l.metrics.resultsMax/l.metrics.targetsMax*100)/10)).toString()),l}let l=null;for(let i=0;i<e.data.length;i++)l=r(e.data[i],i),e.groupObjs[l.unique_id]=l}(),e},e.formatterValue=t=>{let e=Math.ceil(Math.log10(t+1))%3;return 0===e?d3.format(".3s")(t):d3.format("."+(e+1)+"s")(t)},e.formatterValueToolTip=t=>{let e=Math.ceil(Math.log10(t+1))%3;return 0===e?d3.format(".5s")(t):d3.format("."+(e+2)+"s")(t)},e.formatterPercent=t=>100*t%1!=0?d3.format(",.2%")(t):d3.format(",.0%")(t),e.tooltipGenerator=function(t,s){let a='<span class="chart title">'+t.title;t.subtitle&&(a+=" "+t.subtitle);let r="";a+="</span><hr>Targets:";let l=0,i="";for(let n of t.metrics.targets)s.name===n.name&&(r="selected"),e.settings.cumulativeTargets?n.value>l&&(l=n.value):l+=n.value,i+="<span class='"+r+"'><span class='target title'>"+n.name+"</span> : <span class='target value '>"+e.formatterValueToolTip(n.value)+"</span></span><br >",r="";for(let u of(t.metrics.targets.length>1?a+=" "+e.formatterValueToolTip(l)+"<br >":a+="<br >",a+=i,t.metrics.targetsMarkers))s.name===u.name&&(r="selected"),a+="<span class='"+r+"'><span class='target-metrics title '>> "+u.name+"</span> : <span class='target-metrics value '>"+e.formatterValueToolTip(u.value)+"</span></span><br >",r="";a+="<hr>Results:";let o=0,m="";for(let g of t.metrics.results)s.name===g.name&&(r="selected"),e.settings.cumulativeResults?g.value>o&&(o=+g.value):o+=+g.value,m+="<span class='"+r+"'><span class='result title '>"+g.name+"</span> : <span class='result value '>"+e.formatterValueToolTip(g.value)+" | "+e.formatterPercent(g.percent_to_target)+"</span></span><br >",r="";for(let c of(t.metrics.results.length>1?a+=" "+e.formatterValueToolTip(o)+"<br >":a+="<br >",a+=m,t.metrics.resultsMarkers))s.name===c.name&&(r="selected"),a+="<span class='"+r+"'><span class='result-marketer title '>> "+c.name+"</span> : <span class='result-marker value '>"+e.formatterValueToolTip(c.value)+" | "+e.formatterPercent(c.percent_to_target)+"</span></span><br >",r="";return a},e.update=function(){function t(t){var s,r;let l={xScale:null,widthCalc:null,calcTargetWidth:null,calcResultWidth:null};e.settings._constrainToTarget?l.xScale=d3.scaleLinear().domain([0,t.targetsMax]).range([0,e.barWidth]):l.xScale=d3.scaleLinear().domain([0,t.metricsMax]).range([0,e.barWidth]),l.calcWidth=(r=(s=l.xScale)(0),t=>Math.abs(s(t)-r));let i=(t,e,s)=>(a,r)=>r>0&&r<=e.length-1&&s?Math.abs(t(a.value)-t(e[r-1].value)):l.calcWidth(a.value);l.calcTargetWidth=i(l.xScale,t.targets,e.settings.cumulativeTargets),l.calcResultWidth=i(l.xScale,t.results,e.settings.cumulativeResults),l.calcTargetMarkerX=t=>l.calcWidth(t.value)+e.settings.titlePadding,l.calcResultMarkerX=t=>l.calcWidth(t.value)+e.settings.titlePadding;let n=(t,s)=>function(a,r){let l=e.settings.titlePadding;return r>0&&r<=s.length-1?l+t(s[r-1].value):l},u=(t,s)=>function(a,r){let l=e.settings.titlePadding;if(!(r>0)||!(r<=s.length-1))return l;for(let i=r-1;i>=0;i--)l+=t(s[i].value);return l};return l.calcTargetX=e.settings.cumulativeTargets?n(l.xScale,t.targets):u(l.xScale,t.targets),l.calcResultX=e.settings.cumulativeResults?n(l.xScale,t.results):u(l.xScale,t.results),l.targetBarFormat=(t,s)=>{let r="target s"+s,i=l.calcTargetWidth(t,s);for(let n=0;n<=Math.round(i);n+=e.settings.w_threshold)r+=` w${n}`;return r+=" "+a(t.column),t.column!==t.name&&(r+=" "+a(t.name)),t.classes&&t.classes.length&&(r+=t.classes.join(" ")),r},l.targetTextLabel=(t,s)=>e.formatterValue(t.value),l.targetTextFormat=(t,e)=>{let s="target text s"+e;return s+=" "+a(t.column),t.column!==t.name&&(s+=" "+a(t.name)),s},l.targetsYPos=(t,s)=>{let a=0;return e.settings.summarizeTargets&&(a+=e.barHeight),a},l.resultBarFormat=(s,r)=>{let i="result s"+r,n=l.calcResultWidth(s,r);for(let u=0;u<=Math.round(n);u+=e.settings.w_threshold)i+=` w${u}`;for(let o=0;o<=s.percent_to_target;o+=e.settings.p_threshold)i+=` p${Math.round(100*o)}`;return r===t.resultsLastIndex&&(i+=" last"),i+=" "+a(s.column),s.column!==s.name&&(i+=" "+a(s.name)),s.classes&&s.classes.length&&(i+=s.classes.join(" ")),i},l.resultTextLabel=(t,s)=>{let a=e.formatterValue(t.value);return l.calcResultWidth(t,s)>=e.settings.minWidthForPercent&&(a+=" ("+e.formatterPercent(t.percent_to_target)+")"),a},l.resultsYPos=(t,s)=>{let a=e.barHeight;return e.settings.summarizeTargets&&(a+=e.barHeight),e.settings.summarizeResults&&(a+=e.barHeight),a},l.resultTextFormat=(t,e)=>{let s="result text s"+e;return s+=" "+a(t.column),t.column!==t.name&&(s+=" "+a(t.name)),s},l.targetMarkerFormat=(t,e)=>{let s="marker s"+e;return t.classes&&t.classes.length&&(s+=t.classes.join(" ")),s+=" "+a(t.column),t.column!==t.name&&(s+=" "+a(t.name)),s},l.resultMarkerFormat=(t,s)=>{let r="marker s"+s;for(let l=0;l<=t.percent_to_target;l+=e.settings.p_threshold)r+=` p${Math.round(100*l)}`;return t.classes&&t.classes.length&&(r+=t.classes.join(" ")),r+=" "+a(t.column),t.column!==t.name&&(r+=" "+a(t.name)),r},l}function s(t){t.svg.targets=t.g.append("g").attr("class","targets");let s=t.svg.targets.selectAll("svg").data(t.metrics.targets).enter().append("svg").attr("class",t.methods.targetBarFormat).attr("width",t.methods.calcTargetWidth).attr("height",e.barHeight).attr("y",t.methods.targetsYPos).attr("x",t.methods.calcTargetX);s.append("rect").attr("class",t.methods.targetBarFormat).attr("width","100%").attr("height","100%"),s.append("text").attr("class",t.methods.targetTextFormat).attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").style("text-anchor","middle").text(function(e,s){return t.methods.targetTextLabel(e)});let a=t.svg.targets.node().getBBox().width+e.settings.titlePadding;t.svg.results=t.g.append("g").attr("class","results");let r=t.svg.results.selectAll("svg").data(t.metrics.results).enter().append("svg").attr("class",t.methods.resultBarFormat).attr("width",t.methods.calcResultWidth).attr("height",e.barHeight).attr("x",t.methods.calcResultX).attr("y",t.methods.resultsYPos);r.append("rect").attr("class",t.methods.resultBarFormat).attr("width","100%").attr("height","100%"),r.append("text").attr("class",t.methods.resultTextFormat).attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(function(e,s){return t.methods.resultTextLabel(e,s)});let l=t.svg.results.node().getBBox().width+e.settings.titlePadding;if(l>e.barWidth-75?t.svg.results.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(s,a){return t.methods.resultsYPos(s,a)+e.barHeight+4}).attr("x",l).attr("dominant-baseline","hanging").attr("text-anchor","end").text(e.formatterValue(t.metrics.resultsMax)+" ("+e.formatterPercent(t.metrics.resultsMax/t.metrics.targetsMax)+")"):t.svg.results.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(s,a){return t.methods.resultsYPos(s,a)+e.barHeight/2}).attr("x",l+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(e.formatterValue(t.metrics.resultsMax)+" ("+e.formatterPercent(t.metrics.resultsMax/t.metrics.targetsMax)+")"),t.svg.targetsMarkers=t.g.append("g").attr("class","targets-markers"),t.svg.targetsMarkers.selectAll("svg").data(t.metrics.targetsMarkers).enter().append("line").attr("class",t.methods.targetMarkerFormat).attr("x1",t.methods.calcTargetMarkerX).attr("x2",t.methods.calcTargetMarkerX).attr("y1",t.methods.targetsYPos).attr("y2",function(s,a){return t.methods.targetsYPos(s,a)+e.barHeight}),t.svg.resultsMarkers=t.g.append("g").attr("class","results-markers"),t.svg.resultsMarkers.selectAll("svg").data(t.metrics.resultsMarkers).enter().append("line").attr("class",t.methods.resultMarkerFormat).attr("x1",t.methods.calcResultMarkerX).attr("x2",t.methods.calcResultMarkerX).attr("y1",t.methods.resultsYPos).attr("y2",function(s,a){return t.methods.resultsYPos(s,a)+e.barHeight}),e.settings.summarizeTargets){t.svg.targetsSummary=t.g.append("g").attr("class","targets-summary");let i=t.svg.targetsSummary.append("svg").attr("class","summary").attr("width",a-e.settings.titlePadding).attr("height",e.barHeight).attr("x",e.settings.titlePadding).attr("y","0");i.append("rect").attr("class","summary").attr("width","100%").attr("height","100%"),a-e.settings.titlePadding<=e.settings.minWidthForPercent?t.svg.resultsSummary.append("text").attr("class","summary").attr("dy",".1em").attr("y",.5*e.barHeight).attr("x",a+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(e.formatterValue(t.metrics.targetsMax)):i.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(e.formatterValue(t.metrics.targetsMax))}if(e.settings.summarizeResults){t.svg.resultsSummary=t.g.append("g").attr("class","results-summary");let n=t.svg.resultsSummary.append("svg").attr("class","summary").attr("width",l-e.settings.titlePadding).attr("height",e.barHeight).attr("x",e.settings.titlePadding).attr("y",function(s,a){return t.methods.targetsYPos(1,1)+e.barHeight});n.append("rect").attr("class","summary").attr("width","100%").attr("height","100%"),l-e.settings.titlePadding<=e.settings.minWidthForPercent?t.svg.resultsSummary.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(s,a){return t.methods.targetsYPos(1,1)+1.5*e.barHeight}).attr("x",l+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(e.formatterValue(t.metrics.resultsMax)+" ("+e.formatterPercent(t.metrics.resultsMax/t.metrics.targetsMax)+")"):n.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(e.formatterValue(t.metrics.resultsMax)+" ("+e.formatterPercent(t.metrics.resultsMax/t.metrics.targetsMax)+")")}return t}for(let r in e.groupObjs)e.groupObjs[r].methods=t(e.groupObjs[r].metrics),s(e.groupObjs[r])},e.set(t),e.render=function(){return e.objs.mainDiv=d3.select(e.settings.selector),e.objs.mainDiv.node().classList.add("pace-chart"),e.objs.mainDiv.append("div").attr("class","inner-box").style("display","flex").style("flex-wrap","wrap"),e.selector=e.settings.selector+" .inner-box",e.objs.chartDiv=d3.select(e.selector),e.objs.g=e.objs.chartDiv.selectAll("div.chart-area").data(e.data).enter().append("div").attr("class","group chart-area").append("svg").attr("width",e.width).attr("height",e.height),e.objs.titles=e.objs.g.append("g").style("text-anchor","end"),e.objs.titles.append("text").attr("class","title").attr("x","95").attr("y",e.barHeight*(2+e.settings.summarizeTargets+e.settings.summarizeResults)/2).text(function(t){return t[e.settings.titleCols[0]]}),e.objs.titles.append("text").attr("class","subtitle").attr("dy","1em").attr("x","95").attr("y",e.barHeight*(2+e.settings.summarizeTargets+e.settings.summarizeResults)/2).text(function(t){return t[e.settings.titleCols[1]]}),e.objs.tooltip=e.objs.mainDiv.append("div").attr("class","tooltip"),e.objs.g.each(function(t,r){for(let l in e.groupObjs)l===t.unique_id&&(e.groupObjs[l].g=d3.select(this),e.groupObjs[l].g.attr("class",a(e.groupObjs[l].title)+" "+a(e.groupObjs[l].subtitle)),e.groupObjs[l].g.attr("id",e.groupObjs[l].unique_id),e.groupObjs[l].g.on("mouseover",function(t,s){e.objs.tooltip.style("display",null).style("left",t.pageX+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){e.objs.tooltip.style("display","none")}).on("mousemove",function(t,a){e.objs.tooltip.style("left",t.pageX+10+"px").style("top",t.pageY-10+"px"),s(e.groupObjs[l],t.target.__data__)()}))}),e.update(),e},e}
