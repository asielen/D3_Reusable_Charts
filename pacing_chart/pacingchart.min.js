function makePacingChart(settings){let chart={};chart.settings={data:null,selector:null,targetsCols:[],targetsMarkersCols:[],resultsCols:[],resultMarkersCols:[],titleCols:[],linkCol:null,chartWidth:450,barHeight:30,titlePadding:75,lowerSummaryPadding:20,minWidthForPercent:100,respChartCols:2,cumulativeTargets:true,cumulativeResults:true,summarizeTargets:false,summarizeResults:false,barRadiusTargets:{t:{l:4,i:0,r:4},b:{l:0,i:0,r:0},hang:true},barRadiusResults:{t:{l:0,i:0,r:0},b:{l:4,i:0,r:4},hang:true},w_threshold:25,p_threshold:.1,_constrainToTarget:false};chart.groupObjs={};chart.objs={mainDiv:null,chartDiv:null,g:null};chart.set=settings_map=>{for(let setting in settings_map){chart.settings[setting]=settings_map[setting];if(setting==="data"){chart.data=chart.settings.data}if(["formatterValue","formatterValueToolTip","formatterPercent","tooltipGenerator"].includes(setting)&&typeof settings_map[setting]==="function"){chart[setting]=settings_map[setting]}}chart.width=chart.settings.chartWidth;chart.height=chart.settings.barHeight*(2+chart.settings.summarizeTargets+chart.settings.summarizeResults)+chart.settings.lowerSummaryPadding;chart.barWidth=chart.settings.chartWidth-chart.settings.titlePadding;chart.barHeight=chart.settings.barHeight;chart.currentChartWidth=chart.settings.chartWidth;return chart};chart.call=func=>{func(chart);return chart};function prepareData(){function roundUpNearest10(num){return Math.round(Math.ceil(num/10)*10)}let valueSort=(a,b)=>{if(a.value<b.value)return-1;if(a.value>b.value)return 1;return 0};let parseValues=(columnNames,current_row,is_cumulative)=>{let metricsObj=[];for(const column of columnNames){let ref=column;let name=column;if(typeof column!="string"){ref=column[0];name=column[1]}metricsObj.push({column:ref,name:name,value:chart.data[current_row][ref]});if(!is_cumulative){metricsObj.sort(valueSort)}}return metricsObj};function makechartObj(row,index){let chartObj={title:"",subtitle:null,index:0,classes:[],unique_id:"",svg:{parent:null,title:null,subtitle:null,targets:null,results:null,targetsMarkers:null,resultsMarkers:null},metrics:{},link:""};chartObj.index=index;chartObj.unique_id="g"+index+"-"+Math.random().toString(16).slice(2);row.unique_id=chartObj.unique_id;if(typeof chart.settings.titleCols!="string"){chartObj.title=row[chart.settings.titleCols[0]];chartObj.subtitle=row[chart.settings.titleCols[1]]}else{chartObj.title=row[chart.settings.titleCols]}if(chart.settings.linkCol){chartObj.link=row[chart.settings.linkCol]}chartObj.metrics.targets=parseValues(chart.settings.targetsCols,index,chart.settings.cumulativeTargets);chartObj.metrics.targetsMarkers=parseValues(chart.settings.targetsMarkersCols,index,chart.settings.cumulativeTargets);chartObj.metrics.targetsLastIndex=chartObj.metrics.targets.length-1;chartObj.metrics.results=parseValues(chart.settings.resultsCols,index,chart.settings.cumulativeResults);chartObj.metrics.resultsMarkers=parseValues(chart.settings.resultMarkersCols,index,chart.settings.cumulativeResults);chartObj.metrics.resultsLastIndex=chartObj.metrics.results.length-1;chartObj.metrics.targetsMax=(!chart.settings.cumulativeTargets?chartObj.metrics.targets.map(o=>+o.value).reduce((a,b)=>a+b):Math.max(...chartObj.metrics.targets.map(o=>o.value)))||0;chartObj.metrics.targetsMarkersMax=Math.max(...chartObj.metrics.targetsMarkers.map(o=>o.value))||0;chartObj.metrics.resultsMax=(!chart.settings.cumulativeResults?chartObj.metrics.results.map(o=>+o.value).reduce((a,b)=>a+b):Math.max(...chartObj.metrics.results.map(o=>o.value)))||0;chartObj.metrics.resultsMin=Math.min(...chartObj.metrics.results.map(o=>o.value))||0;chartObj.metrics.resultsMarkersMax=Math.max(...chartObj.metrics.resultsMarkers.map(o=>o.value))||0;chartObj.metrics.resultsMarkersMin=Math.min(...chartObj.metrics.resultsMarkers.map(o=>o.value))||0;chartObj.metrics.metricsMax=Math.max(chartObj.metrics.targetsMax,chartObj.metrics.resultsMax,chartObj.metrics.targetsMarkersMax,chartObj.metrics.resultsMarkersMax);chartObj.metrics.targetGreater=0;chartObj.metrics.results.forEach(result=>{result.percent_to_target=result.value/chartObj.metrics.targetsMax});chartObj.metrics.resultsMarkers.forEach(result=>{result.percent_to_target=result.value/chartObj.metrics.targetsMax});chartObj.classes.push("p"+roundUpNearest10(chartObj.metrics.resultsMax/chartObj.metrics.targetsMax*100).toString());return chartObj}let current_obj=null;for(let current_row=0;current_row<chart.data.length;current_row++){current_obj=makechartObj(chart.data[current_row],current_row);chart.groupObjs[current_obj.unique_id]=current_obj}}chart.formatterValue=d=>{let dmod=Math.ceil(Math.log10(d+1))%3;if(dmod===0){return d3.format(".3s")(d)}else{return d3.format("."+(dmod+1)+"s")(d)}};chart.formatterValueToolTip=d=>{if(!d){d=0}let dmod=Math.ceil(Math.log10(d+1))%3;if(dmod===0){return d3.format(".5s")(d)}else{return d3.format("."+(dmod+2)+"s")(d)}};chart.formatterPercent=d=>{if(d*100%1!==0){return d3.format(",.2%")(d)}else{return d3.format(",.0%")(d)}};chart.tooltipGenerator=function(groupObj,event){let tooltipString='<span class="chart title">'+groupObj.title;if(groupObj.subtitle){tooltipString+=" | "+groupObj.subtitle}let selected="";tooltipString+="</span><hr>Targets:";let target_total=0;let target_string="";for(const target of groupObj.metrics.targets){if(event.name===target.name){selected="selected"}if(chart.settings.cumulativeTargets){if(target.value>target_total){target_total=target.value}}else{target_total+=target.value}target_string+="<span class='"+selected+"'><span class='target title'>"+target.name+"</span> : <span class='target value '>"+chart.formatterValueToolTip(target.value)+"</span></span><br >";selected=""}if(groupObj.metrics.targets.length>1){tooltipString+=" "+chart.formatterValueToolTip(target_total)+"<br >"}else{tooltipString+="<br >"}tooltipString+=target_string;for(const target of groupObj.metrics.targetsMarkers){if(event.name===target.name){selected="selected"}tooltipString+="<span class='"+selected+"'><span class='target-metrics title '>> "+target.name+"</span> : <span class='target-metrics value '>"+chart.formatterValueToolTip(target.value)+"</span></span><br >";selected=""}tooltipString+="<hr>Results:";let result_total=0;let result_string="";for(const result of groupObj.metrics.results){if(event.name===result.name){selected="selected"}if(chart.settings.cumulativeResults){if(result.value>result_total){result_total=+result.value}}else{result_total+=+result.value}result_string+="<span class='"+selected+"'><span class='result title '>"+result.name+"</span> : <span class='result value '>"+chart.formatterValueToolTip(result.value)+" | "+chart.formatterPercent(result.percent_to_target)+"</span></span><br >";selected=""}if(groupObj.metrics.results.length>1){tooltipString+=" "+chart.formatterValueToolTip(result_total)+"<br >"}else{tooltipString+="<br >"}tooltipString+=result_string;for(const result of groupObj.metrics.resultsMarkers){if(event.name===result.name){selected="selected"}tooltipString+="<span class='"+selected+"'><span class='result-marketer title '>> "+result.name+"</span> : <span class='result-marker value '>"+chart.formatterValueToolTip(result.value)+" | "+chart.formatterPercent(result.percent_to_target)+"</span></span><br >";selected=""}return tooltipString};function tooltipRender(groupObj,event){return function(){chart.objs.tooltip.transition().duration(200);chart.objs.tooltip.html(chart.tooltipGenerator(groupObj,event))}}function makeSafeForCSS(name){if(!name){return""}name=name.replace(/[^a-z0-9-]/g,function(s){var c=s.charCodeAt(0);if(c==32||c==95)return"-";if(c>=65&&c<=90)return s.toLowerCase();return"_"});if(name.match(/^[0-9]/g)){name="_"+name}return name}chart.resize=function(event){if(chart.settings.respChartCols<1)return;let width=parseInt(chart.objs.mainDiv.style("width"),10);let chartWidth=Math.max(chart.settings.chartWidth*chart.settings.respChartCols,chart.settings.chartWidth);if(width<chartWidth||width>chart.currentChartWidth*chart.settings.respChartCols&&width<chartWidth){chart.currentChartWidth=width/chart.settings.respChartCols;chart.objs.g.attr("width",chart.currentChartWidth)}};chart.update=function(){function calcMethods(metrics){let methods={xScale:null,widthCalc:null,calcTargetWidth:null,calcResultWidth:null};if(!chart.settings._constrainToTarget){methods.xScale=d3.scaleLinear().domain([0,metrics.metricsMax]).range([0,chart.barWidth])}else{methods.xScale=d3.scaleLinear().domain([0,metrics.targetsMax]).range([0,chart.barWidth])}methods.calcWidth=n=>{return Math.abs(methods.xScale(n||0)-methods.xScale(0))};const calcWidthLessPrevious=(values,cumulative)=>{return(n,i)=>{if(i>0&&i<=values.length-1&&cumulative){return Math.abs(methods.xScale(n.value)-methods.xScale(values[i-1].value))}else{return methods.calcWidth(n.value)}}};methods.calcTargetWidth=calcWidthLessPrevious(metrics.targets,chart.settings.cumulativeTargets);methods.calcResultWidth=calcWidthLessPrevious(metrics.results,chart.settings.cumulativeResults);methods.calcTargetMarkerXPos=n=>{return methods.calcWidth(n.value)+chart.settings.titlePadding};methods.calcResultMarkerXPos=n=>{return methods.calcWidth(n.value)+chart.settings.titlePadding};const calcXLessPrevious=(values,cumulative)=>{return function(d,i){let x=chart.settings.titlePadding;if(i>0&&i<=values.length-1){for(let j=i-1;j>=0;j--){x+=methods.xScale(values[j].value);if(cumulative){break}}}return x}};methods.calcTargetX=calcXLessPrevious(metrics.targets,chart.settings.cumulativeTargets);methods.calcResultX=calcXLessPrevious(metrics.results,chart.settings.cumulativeResults);metrics.targetGreater=methods.calcWidth(metrics.targetsMax)-methods.calcWidth(metrics.resultsMax);const pathFactory=(width_func,radius,last_index,hang_check,hasSummary,isSummary)=>{return function(d,i){let r={t:{l:0,i:0,r:0},b:{l:0,i:0,r:0},hang:true};let w=width_func(d,i),h=chart.barHeight;if(i!==0){r.t.l=radius.t.i;r.b.l=radius.b.i}else{r.t.l=hasSummary?0:radius.t.l;r.b.l=isSummary?0:radius.b.l}if(i!==last_index){r.t.r=radius.t.i;r.b.r=radius.b.i}else{let hr=Math.max(radius.b.r,radius.t.r);if(radius.hang&&hang_check>0&&(radius.b.r===0||radius.t.r===0)){if(hang_check<hr){r.t.r=hasSummary?0:radius.t.r>0?hr:hang_check;r.b.r=radius.b.r>0?hr:hang_check}else{r.t.r=hasSummary?0:hr;r.b.r=isSummary?0:hr}}else{r.t.r=hasSummary?0:radius.t.r;r.b.r=isSummary?0:radius.b.r}}if(w<r.t.l+r.t.r||w<r.b.r+r.b.l){let rt=w/2;r.t.l=r.t.l?rt:0;r.t.r=r.t.r?rt:0;r.b.l=r.b.l?rt:0;r.b.r=r.b.r?rt:0}let top=Math.max(w-r.t.l-r.t.r,0),right=h-r.t.r-r.b.r,bottom=Math.max(w-r.b.r-r.b.l,0),left=h-r.b.l-r.t.l;let path_string=`M${r.t.l},0 h${top} a${r.t.r} ${r.t.r}, 0, 0, 1, ${r.t.r} ${r.t.r} v${right} a${r.b.r} ${r.b.r}, 0, 0, 1, -${r.b.r} ${r.b.r} h-${bottom} a${r.b.l} ${r.b.l}, 0, 0, 1, -${r.b.l} -${r.b.l} v-${left} a${r.t.l} ${r.t.l}, 0, 0, 1, ${r.t.l} -${r.t.l} z`;return path_string}};methods.resultsPath=pathFactory(methods.calcResultWidth,chart.settings.barRadiusResults,metrics.resultsLastIndex,-metrics.targetGreater,chart.settings.summarizeResults,false);methods.targetsPath=pathFactory(methods.calcTargetWidth,chart.settings.barRadiusTargets,metrics.targetsLastIndex,metrics.targetGreater,chart.settings.summarizeTargets,false);methods.resultsSummaryPath=pathFactory(methods.calcResultWidth,chart.settings.barRadiusResults,0,-metrics.targetGreater,false,true);methods.targetsSummaryPath=pathFactory(methods.calcTargetWidth,chart.settings.barRadiusTargets,0,metrics.targetGreater,false,true);methods.targetBarFormat=(d,i)=>{let return_text="target s"+i;let width=methods.calcTargetWidth(d,i);for(let i=0;i<=Math.round(width);i+=chart.settings.w_threshold){return_text+=" w"+`${i}`}return_text+=" "+makeSafeForCSS(d.column);if(d.column!==d.name){return_text+=" "+makeSafeForCSS(d.name)}if(d.classes&&d.classes.length){return_text+=d.classes.join(" ")}return return_text};methods.targetTextLabel=(d,i)=>{return chart.formatterValue(d.value)};methods.targetsYPos=(d,i)=>{let y=0;if(chart.settings.summarizeTargets){y+=chart.barHeight}return y};methods.resultBarFormat=(d,i)=>{let return_text="result s"+i;let width=methods.calcResultWidth(d,i);for(let i=0;i<=Math.round(width);i+=chart.settings.w_threshold){return_text+=" w"+`${i}`}if(d.percent_to_target!=Infinity){for(let i=0;i<=d.percent_to_target;i+=chart.settings.p_threshold){return_text+=" p"+`${Math.round(i*100)}`}}if(i===metrics.resultsLastIndex){return_text+=" last"}return_text+=" "+makeSafeForCSS(d.column);if(d.column!==d.name){return_text+=" "+makeSafeForCSS(d.name)}if(d.classes&&d.classes.length){return_text+=d.classes.join(" ")}return return_text};methods.resultTextLabel=(d,i)=>{let return_text=chart.formatterValue(d.value);let width=methods.calcResultWidth(d,i);if(d.percent_to_target!=Infinity&&width>=chart.settings.minWidthForPercent){return_text+=" ("+chart.formatterPercent(d.percent_to_target)+")"}return return_text};methods.resultsYPos=(d,i)=>{let y=chart.barHeight;if(chart.settings.summarizeTargets){y+=chart.barHeight}if(chart.settings.summarizeResults){y+=chart.barHeight}return y};methods.targetMarkerFormat=(d,i)=>{let return_text="marker s"+i;if(d.classes&&d.classes.length){return_text+=d.classes.join(" ")}return_text+=" "+makeSafeForCSS(d.column);if(d.column!==d.name){return_text+=" "+makeSafeForCSS(d.name)}return return_text};methods.resultMarkerFormat=(d,i)=>{let return_text="marker s"+i;if(d.percent_to_target!=Infinity){for(let i=0;i<=d.percent_to_target;i+=chart.settings.p_threshold){return_text+=" p"+`${Math.round(i*100)}`}}if(d.classes&&d.classes.length){return_text+=d.classes.join(" ")}return_text+=" "+makeSafeForCSS(d.column);if(d.column!==d.name){return_text+=" "+makeSafeForCSS(d.name)}return return_text};return methods}function buildChartObj(chartObj){if(chartObj.link){chartObj.g.node().parentNode.href=chartObj.link}chartObj.svg.bars=chartObj.g.append("g").attr("class","bars");chartObj.svg.targets=chartObj.svg.bars.append("g").attr("class","targets");let g=chartObj.svg.targets.selectAll("svg").data(chartObj.metrics.targets).enter().append("svg").attr("class",chartObj.methods.targetBarFormat).attr("width",chartObj.methods.calcTargetWidth).attr("height",chart.barHeight).attr("y",chartObj.methods.targetsYPos).attr("x",chartObj.methods.calcTargetX);g.append("path").attr("d",chartObj.methods.targetsPath);g.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").style("text-anchor","middle").text(function(d,i){return chartObj.methods.targetTextLabel(d)});let xtEnd=chartObj.svg.targets.node().getBBox().width+chart.settings.titlePadding;chartObj.svg.results=chartObj.svg.bars.append("g").attr("class","results");let r=chartObj.svg.results.selectAll("svg").data(chartObj.metrics.results).enter().append("svg").attr("class",chartObj.methods.resultBarFormat).attr("width",chartObj.methods.calcResultWidth).attr("height",chart.barHeight).attr("x",chartObj.methods.calcResultX).attr("y",chartObj.methods.resultsYPos);r.append("path").attr("d",chartObj.methods.resultsPath);r.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(function(d,i){return chartObj.methods.resultTextLabel(d,i)});let xEnd=chartObj.svg.results.node().getBBox().width+chart.settings.titlePadding;if(xEnd>chart.barWidth-75){chartObj.svg.results.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(d,i){return chartObj.methods.resultsYPos(d,i)+chart.barHeight+4}).attr("x",xEnd).attr("dominant-baseline","hanging").attr("text-anchor","end").text(chart.formatterValue(chartObj.metrics.resultsMax)+" ("+chart.formatterPercent(chartObj.metrics.resultsMax/chartObj.metrics.targetsMax)+")")}else{chartObj.svg.results.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(d,i){return chartObj.methods.resultsYPos(d,i)+chart.barHeight/2}).attr("x",xEnd+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(chart.formatterValue(chartObj.metrics.resultsMax)+" ("+chart.formatterPercent(chartObj.metrics.resultsMax/chartObj.metrics.targetsMax)+")")}chartObj.svg.targetsMarkers=chartObj.svg.bars.append("g").attr("class","targets-markers");let tm=chartObj.svg.targetsMarkers.selectAll("svg").data(chartObj.metrics.targetsMarkers).enter().append("line").attr("class",chartObj.methods.targetMarkerFormat).attr("x1",chartObj.methods.calcTargetMarkerXPos).attr("x2",chartObj.methods.calcTargetMarkerXPos).attr("y1",chartObj.methods.targetsYPos).attr("y2",function(d,i){return chartObj.methods.targetsYPos(d,i)+chart.barHeight});chartObj.svg.resultsMarkers=chartObj.svg.bars.append("g").attr("class","results-markers");let rm=chartObj.svg.resultsMarkers.selectAll("svg").data(chartObj.metrics.resultsMarkers).enter().append("line").attr("class",chartObj.methods.resultMarkerFormat).attr("x1",chartObj.methods.calcResultMarkerXPos).attr("x2",chartObj.methods.calcResultMarkerXPos).attr("y1",chartObj.methods.resultsYPos).attr("y2",function(d,i){return chartObj.methods.resultsYPos(d,i)+chart.barHeight});if(chart.settings.summarizeTargets){chartObj.svg.targetsSummary=chartObj.svg.bars.append("g").attr("class","targets-summary");let ts=chartObj.svg.targetsSummary.append("svg").attr("class","summary").attr("width",xtEnd-chart.settings.titlePadding).attr("height",chart.barHeight).attr("x",chart.settings.titlePadding).attr("y","0");ts.append("path").attr("class","target summary").attr("d",function(){return chartObj.methods.targetsSummaryPath({value:chartObj.metrics.targetsMax,name:"targetsSummary"},0)});if(xtEnd-chart.settings.titlePadding<=chart.settings.minWidthForPercent){chartObj.svg.resultsSummary.append("text").attr("class","summary").attr("dy",".1em").attr("y",chart.barHeight*.5).attr("x",xtEnd+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(chart.formatterValue(chartObj.metrics.targetsMax))}else{ts.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(chart.formatterValue(chartObj.metrics.targetsMax))}}if(chart.settings.summarizeResults){chartObj.svg.resultsSummary=chartObj.svg.bars.append("g").attr("class","results-summary");let rs=chartObj.svg.resultsSummary.append("svg").attr("class","summary").attr("width",xEnd-chart.settings.titlePadding).attr("height",chart.barHeight).attr("x",chart.settings.titlePadding).attr("y",function(d,i){return chartObj.methods.targetsYPos(1,1)+chart.barHeight});rs.append("path").attr("class","result summary").attr("d",function(){return chartObj.methods.resultsSummaryPath({value:chartObj.metrics.resultsMax,name:"resultsSummary"},0)});if(xEnd-chart.settings.titlePadding<=chart.settings.minWidthForPercent){chartObj.svg.resultsSummary.append("text").attr("class","summary").attr("dy",".1em").attr("y",function(d,i){return chartObj.methods.targetsYPos(1,1)+chart.barHeight*1.5}).attr("x",xEnd+5).attr("dominant-baseline","middle").attr("text-anchor","start").text(chart.formatterValue(chartObj.metrics.resultsMax)+" ("+chart.formatterPercent(chartObj.metrics.resultsMax/chartObj.metrics.targetsMax)+")")}else{rs.append("text").attr("dy",".1em").attr("y","50%").attr("x","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").text(chart.formatterValue(chartObj.metrics.resultsMax)+" ("+chart.formatterPercent(chartObj.metrics.resultsMax/chartObj.metrics.targetsMax)+")")}}return chartObj}for(const p in chart.groupObjs){chart.groupObjs[p].methods=calcMethods(chart.groupObjs[p].metrics);buildChartObj(chart.groupObjs[p])}};chart.set(settings);chart.render=function(){prepareData();chart.objs.mainDiv=d3.select(chart.settings.selector);chart.objs.mainDiv.node().classList.add("pace-chart");chart.objs.mainDiv.append("div").attr("class","inner-box").style("display","flex").style("flex-wrap","wrap");chart.selector=chart.settings.selector+" .inner-box";chart.objs.chartDiv=d3.select(chart.selector);chart.objs.g=chart.objs.chartDiv.selectAll("div.chart-area").data(chart.data).enter().append("div").attr("class","group chart-area");if(chart.settings.linkCol){chart.objs.g=chart.objs.g.append("a").attr("target","_blank").attr("rel","noreferrer noopener")}chart.objs.g=chart.objs.g.append("svg").attr("width",chart.width).attr("height",chart.height).attr("viewBox","0 0 "+chart.width+" "+chart.height);chart.objs.titles=chart.objs.g.append("g").style("text-anchor","end").attr("class","titles");chart.objs.titles.append("text").attr("class","title").attr("x",chart.settings.titlePadding-5).attr("y",chart.barHeight*(2+chart.settings.summarizeTargets+chart.settings.summarizeResults)/2).text(function(d){return d[chart.settings.titleCols[0]]});chart.objs.titles.append("text").attr("class","subtitle").attr("dy","1em").attr("x",chart.settings.titlePadding-5).attr("y",chart.barHeight*(2+chart.settings.summarizeTargets+chart.settings.summarizeResults)/2).text(function(d){return d[chart.settings.titleCols[1]]});if(chart.settings.respChartCols>0){d3.select(window).on("resize."+chart.selector,function(d){chart.resize(d)})}chart.objs.tooltip=chart.objs.mainDiv.append("div").attr("class","tooltip");chart.objs.g.each(function(g,i){for(let unique_id in chart.groupObjs){if(unique_id===g["unique_id"]){chart.groupObjs[unique_id].g=d3.select(this);chart.groupObjs[unique_id].g.attr("class",makeSafeForCSS(chart.groupObjs[unique_id].title)+" "+makeSafeForCSS(chart.groupObjs[unique_id].subtitle));chart.groupObjs[unique_id].g.attr("id",chart.groupObjs[unique_id].unique_id);chart.groupObjs[unique_id].g.on("mouseover",function(event,d){chart.objs.tooltip.style("display",null).style("left",event.pageX+"px").style("top",event.pageY-28+"px")}).on("mouseout",function(){chart.objs.tooltip.style("display","none")}).on("mousemove",function(event,d){chart.objs.tooltip.style("left",event.pageX+10+"px").style("top",event.pageY-10+"px");tooltipRender(chart.groupObjs[unique_id],event.target.__data__)()})}}});chart.update();return chart};return chart}